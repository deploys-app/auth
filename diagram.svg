<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="733px" preserveAspectRatio="none" style="width:795px;height:733px;background:#FFFFFF;" version="1.1" viewBox="0 0 795 733" width="795px" zoomAndPan="magnify"><defs/><g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="39" x2="39" y1="36.4883" y2="698.0098"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="323" x2="323" y1="36.4883" y2="698.0098"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="447" x2="447" y1="36.4883" y2="698.0098"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="601" x2="601" y1="36.4883" y2="698.0098"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="659" x2="659" y1="36.4883" y2="698.0098"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="745" x2="745" y1="36.4883" y2="698.0098"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="69" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="12" y="25.5352">Browser</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="69" x="5" y="697.0098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="12" y="717.5449">Browser</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="57" x="295" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="302" y="25.5352">Server</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="57" x="295" y="697.0098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="302" y="717.5449">Server</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="47" x="424" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="431" y="25.5352">Auth</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="47" x="424" y="697.0098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="431" y="717.5449">Auth</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="33" x="585" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="19" x="592" y="25.5352">D1</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="33" x="585" y="697.0098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="19" x="592" y="717.5449">D1</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="63" x="628" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="635" y="25.5352">Google</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="63" x="628" y="697.0098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="635" y="717.5449">Google</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="701" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="708" y="25.5352">Hyperdrive</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="701" y="697.0098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="708" y="717.5449">Hyperdrive</text><polygon fill="#181818" points="311.5,63.7988,321.5,67.7988,311.5,71.7988,315.5,67.7988" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="39.5" x2="317.5" y1="67.7988" y2="67.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="32" x="46.5" y="63.0566">login</text><polygon fill="#181818" points="50.5,93.1094,40.5,97.1094,50.5,101.1094,46.5,97.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="44.5" x2="322.5" y1="97.1094" y2="97.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="56.5" y="92.3672">redirect to Auth /</text><polygon fill="#181818" points="435.5,122.4199,445.5,126.4199,435.5,130.4199,439.5,126.4199" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="39.5" x2="441.5" y1="126.4199" y2="126.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="46.5" y="121.6777">request /</text><polygon fill="#181818" points="589.5,151.7305,599.5,155.7305,589.5,159.7305,593.5,155.7305" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="447.5" x2="595.5" y1="155.7305" y2="155.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="454.5" y="150.9883">store session</text><polygon fill="#181818" points="50.5,181.041,40.5,185.041,50.5,189.041,46.5,185.041" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="44.5" x2="446.5" y1="185.041" y2="185.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="56.5" y="180.2988">redirect to Google login</text><polygon fill="#181818" points="647.5,210.3516,657.5,214.3516,647.5,218.3516,651.5,214.3516" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="39.5" x2="653.5" y1="214.3516" y2="214.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="32" x="46.5" y="209.6094">login</text><polygon fill="#181818" points="50.5,239.6621,40.5,243.6621,50.5,247.6621,46.5,243.6621" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="44.5" x2="658.5" y1="243.6621" y2="243.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="56.5" y="238.9199">redirect to Auth /callback</text><polygon fill="#181818" points="435.5,268.9727,445.5,272.9727,435.5,276.9727,439.5,272.9727" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="39.5" x2="441.5" y1="272.9727" y2="272.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="46.5" y="268.2305">request /callback</text><polygon fill="#181818" points="589.5,298.2832,599.5,302.2832,589.5,306.2832,593.5,302.2832" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="447.5" x2="595.5" y1="302.2832" y2="302.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="454.5" y="297.541">get session</text><line style="stroke:#181818;stroke-width:1.0;" x1="447.5" x2="489.5" y1="331.5938" y2="331.5938"/><line style="stroke:#181818;stroke-width:1.0;" x1="489.5" x2="489.5" y1="331.5938" y2="344.5938"/><line style="stroke:#181818;stroke-width:1.0;" x1="448.5" x2="489.5" y1="344.5938" y2="344.5938"/><polygon fill="#181818" points="458.5,340.5938,448.5,344.5938,458.5,348.5938,454.5,344.5938" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="454.5" y="326.8516">verify session</text><polygon fill="#181818" points="647.5,369.9043,657.5,373.9043,647.5,377.9043,651.5,373.9043" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="447.5" x2="653.5" y1="373.9043" y2="373.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="454.5" y="369.1621">get user info</text><polygon fill="#181818" points="458.5,399.2148,448.5,403.2148,458.5,407.2148,454.5,403.2148" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="452.5" x2="658.5" y1="403.2148" y2="403.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="56" x="464.5" y="398.4727">user info</text><polygon fill="#181818" points="589.5,428.5254,599.5,432.5254,589.5,436.5254,593.5,432.5254" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="447.5" x2="595.5" y1="432.5254" y2="432.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="454.5" y="427.7832">store exchange code</text><polygon fill="#181818" points="50.5,457.8359,40.5,461.8359,50.5,465.8359,46.5,461.8359" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="44.5" x2="446.5" y1="461.8359" y2="461.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="56.5" y="457.0938">redirect to Server /callback</text><polygon fill="#181818" points="311.5,487.1465,321.5,491.1465,311.5,495.1465,315.5,491.1465" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="39.5" x2="317.5" y1="491.1465" y2="491.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="46.5" y="486.4043">request /callback</text><polygon fill="#181818" points="435.5,516.457,445.5,520.457,435.5,524.457,439.5,520.457" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="323.5" x2="441.5" y1="520.457" y2="520.457"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="330.5" y="515.7148">exchange token</text><polygon fill="#181818" points="589.5,545.7676,599.5,549.7676,589.5,553.7676,593.5,549.7676" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="447.5" x2="595.5" y1="549.7676" y2="549.7676"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="454.5" y="545.0254">get exchange code</text><line style="stroke:#181818;stroke-width:1.0;" x1="447.5" x2="489.5" y1="579.0781" y2="579.0781"/><line style="stroke:#181818;stroke-width:1.0;" x1="489.5" x2="489.5" y1="579.0781" y2="592.0781"/><line style="stroke:#181818;stroke-width:1.0;" x1="448.5" x2="489.5" y1="592.0781" y2="592.0781"/><polygon fill="#181818" points="458.5,588.0781,448.5,592.0781,458.5,596.0781,454.5,592.0781" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="454.5" y="574.3359">generate token</text><polygon fill="#181818" points="733,617.3887,743,621.3887,733,625.3887,737,621.3887" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="447.5" x2="739" y1="621.3887" y2="621.3887"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="454.5" y="616.6465">store hash(token)</text><polygon fill="#181818" points="334.5,646.6992,324.5,650.6992,334.5,654.6992,330.5,650.6992" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="328.5" x2="446.5" y1="650.6992" y2="650.6992"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="340.5" y="645.957">token</text><polygon fill="#181818" points="50.5,676.0098,40.5,680.0098,50.5,684.0098,46.5,680.0098" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="44.5" x2="322.5" y1="680.0098" y2="680.0098"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260" x="56.5" y="675.2676">redirect to authenticated page with token</text><!--MD5=[4c3e9ad80d9ea910b6daecd0cc8c4b1b]
@startuml Login
Browser -> Server: login
Server -> Browser: redirect to Auth /
Browser -> Auth: request /
Auth -> D1: store session
Auth -> Browser: redirect to Google login
Browser -> Google: login
Google -> Browser: redirect to Auth /callback
Browser -> Auth: request /callback
Auth -> D1: get session
Auth -> Auth: verify session
Auth -> Google: get user info
Google -> Auth: user info
Auth -> D1: store exchange code
Auth -> Browser: redirect to Server /callback
Browser -> Server: request /callback
Server -> Auth: exchange token
Auth -> D1: get exchange code
Auth -> Auth: generate token
Auth -> Hyperdrive: store hash(token)
Auth -> Server: token
Server -> Browser: redirect to authenticated page with token
@enduml

PlantUML version 1.2022.7(Tue Aug 23 00:01:30 ICT 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: TH
--></g></svg>